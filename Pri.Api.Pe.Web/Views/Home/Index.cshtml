<div v-if="loading" class="col col-lg-2 mx-auto text-center">
    <div class="spinner-border text-primary" role="status">
        <span class="sr-only"></span>
    </div>
</div>
<div v-else>
    <div v-if="loggedIn">
        <div v-if="isEmployer">
            <div v-if="selectedJob === null">
                <ul class="job-list">
                    <li v-for="job in jobs" :key="job.id" class="job-card" v-on:click.prevent="selectJob(job)">
                        <div class="job-details">
                            <h2>{{ job.name }}</h2>
                            <p>{{ job.description }}</p>
                            <p>Salary: ${{ job.salary }}</p>
                        </div>
                        <button class="delete-button" v-on:click="openDeleteModal">Delete</button>
                    </li>
                </ul>
                <button v-on:click="addingNewJob = true">Add a new job</button>
            </div>
            <div v-else class="selected-job">
                <div v-if="selectedApplication === null">
                    <h1>{{ selectedJob.name }}</h1>
                    <p>{{ selectedJob.description }}</p>
                    <p>Salary: ${{ selectedJob.salary }}</p>
                    <ul class="applications-list">
                        <li v-for="application in applications" :key="application.id" class="application-card" v-on:click.prevent="selectApplication(application)">
                            <div class="application-details">
                                <h4>{{ application.candidateName }}</h4>
                                <p>Application status: <span :class="[application.applicationStatus.toLowerCase(), application.applicationStatus]">{{ application.applicationStatus }}</span></p>
                                <p>Salary: ${{ application.salary }}</p>
                            </div>
                        </li>
                    </ul>
                    <button v-on:click="clearSelection">Back to Job List</button>
                </div>
                <div v-else>
                    <h1>Application for {{ selectedJob.name }}</h1>
                    <h2>{{ selectedApplication.candidateName }}</h2>
                    <p>Requested salary: ${{ selectedApplication.salary }}</p>
                    <button v-on:click.prevent="acceptApplication">Accept application</button>
                    <button class="delete-button" v-on:click.prevent="rejectApplication">Reject application</button>
                    <button v-on:click="selectedApplication = null">Back to applications</button>
                </div>
            </div>
            <div>
                <form v-if="addingNewJob" v-on:submit.prevent="createNewJob">
                    <div class="form-group">
                        <label>Name</label>
                        <input v-model="newJob.Name" type="text" class="form-control" required/>
                    </div>
                    <div class="form-group">
                        <label>Description</label>
                        <input v-model="newJob.Description" type="text" class="form-control" required/>
                    </div>
                    <div class="form-group">
                        <label>Salary</label>
                        <input v-model="newJob.Salary" type="number" min="10" step="0.1" class="form-control" required/>
                    </div>
                    <div class="form-group">
                        <label>Skills</label>
                        <select v-model="newJob.Skills" multiple>
                            <option v-for="skill in skills" v-bind:value="skill.name">{{ skill.name }}</option>
                        </select>
                    </div>
                    <button type="submit">Create new Job</button>
                </form>
            </div>
        </div>
        <div v-else>
            <div v-if="viewApplications">
                <ul class="applications-list">
                    <li v-for="application in applications" :key="application.id" class="application-card" v-on:click="selectedApplication = application">
                        <div class="application-details">
                            <h2>{{ jobs.find(job => job.id === application.jobId).name }}</h2>
                            <p>Application status: <span :class="[application.applicationStatus.toLowerCase(), application.applicationStatus]">{{ application.applicationStatus }}</span></p>
                            <p>Salary: ${{ application.salary }}</p>
                            <button class="delete-button" v-on:click="openDeleteModal">Delete</button>
                        </div>
                    </li>
                </ul>
            </div>
            <div v-else>
                <div v-if="selectedJob === null">
                    <ul class="job-list">
                        <li v-for="job in jobs" :key="job.id" class="job-card" v-on:click.prevent="selectJob(job)">
                            <div class="job-details">
                                <h2>{{ job.name }}</h2>
                                <p>{{ job.description }}</p>
                                <p>Salary: ${{ job.salary }}</p>
                            </div>
                        </li>
                    </ul>
                </div>
                <div v-else class="selected-job">
                    <h1>{{ selectedJob.name }}</h1>
                    <p>{{ selectedJob.description }}</p>
                    <p>Salary: ${{ selectedJob.salary }}</p>
                    <button v-on:click="clearSelection">Back to Job List</button>
                    <button v-on:click="applyForJob">Apply for this job</button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modals -->
<div v-if="isDeleting" class="delete-modal">
    <div class="modal-content">
        <div class="modal-header">
            <h5 class="modal-title">Delete Confirmation</h5>
            <button type="button" class="close" v-on:click="closeDeleteModal">
                <span aria-hidden="true">&times;</span>
            </button>
        </div>
        <div class="modal-body">
            <p>Are you sure you want to delete this?</p>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-secondary" v-on:click="closeDeleteModal">Cancel</button>
            <button v-if="selectedJob !== null" class="delete-button" v-on:click="deleteJob(selectedJob.id)">Delete</button>
            <button v-if="viewApplications" class="delete-button" v-on:click="deleteApplication(selectedApplication.id)">Delete</button>
        </div>
    </div>
</div>